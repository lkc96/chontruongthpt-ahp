<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>H·ªá h·ªó tr·ª£ ra quy·∫øt ƒë·ªãnh ch·ªçn tr∆∞·ªùng THPT d√¢n l·∫≠p</title>

  <link rel="stylesheet" type="text/css" href="static/css/vendor.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <link rel="stylesheet" href="static/style.css">
  

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">

  <script src="static/js/modernizr.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body data-bs-spy="scroll" data-bs-target="#navbar-example2" tabindex="0">

  <header id="nav" class="site-header position-fixed text-white bg-dark">
    <nav id="navbar-example2" class="navbar navbar-expand-lg py-2">
      <div class="container">
        <a class="navbar-brand" href="./index.html"></a> 
        <!-- <img src="static/images/logo.png" alt="image"> -->
        <button class="navbar-toggler text-white" type="button" data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasNavbar2" aria-controls="offcanvasNavbar2" aria-label="Toggle navigation">
          <ion-icon name="menu-outline" style="font-size: 30px;"></ion-icon>
        </button>

        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar2" aria-labelledby="offcanvasNavbar2Label">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasNavbar2Label">Menu</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <!-- <div class="offcanvas-body">
            <ul class="navbar-nav align-items-center justify-content-end flex-grow-1">
              <li class="nav-item">
                <a class="nav-link active me-md-4 custom-nav-link" href="#billboard">Trang ch·ªß</a>
              </li>
              <li class="nav-item">
                <a class="nav-link me-md-4 custom-nav-link" href="#select-school">Ch·ªçn tr∆∞·ªùng</a>
              </li>
              <li class="nav-item">
                <a class="nav-link me-md-4 custom-nav-link" href="#matrix-comparison">So s√°nh</a>
              </li>
            </ul>
          </div> -->
        <div class="offcanvas-body d-flex flex-column flex-md-row align-items-center">
          <!-- Logo/Ti√™u ƒë·ªÅ ·ªü b√™n tr√°i -->
          <div class="navbar-brand me-auto me-md-6">
            <h5 class="fw-bold m-0" style="font-size: 1.8rem; letter-spacing: 0.01em; color: #2c4236;">
              H·ªÜ TH·ªêNG CH·ªåN TR∆Ø·ªúNG THPT T∆Ø TH·ª§C
            </h5>
          </div>
          
          <!-- Menu ƒëi·ªÅu h∆∞·ªõng ·ªü b√™n ph·∫£i -->
          <ul class="navbar-nav align-items-center justify-content-end">
            <li class="nav-item">
              <a class="nav-link active me-md-4 custom-nav-link" href="#billboard">Trang ch·ªß</a>
            </li>
            <li class="nav-item">
              <a class="nav-link me-md-4 custom-nav-link" href="#select-school">Ch·ªçn tr∆∞·ªùng</a>
            </li>
            <li class="nav-item">
              <a class="nav-link me-md-4 custom-nav-link" href="#matrix-comparison">So s√°nh</a>
            </li>
          </ul>
        </div>
        </div>
      </div>
    </nav>
  </header>

   <!-- billboard start  -->
   <section id="billboard">
    <div class="container">
      <div class="row flex-lg-row-reverse align-items-center">
        <!-- <div class="col-lg-6"> -->
          <section id="map-section" class="mb-5">
            <!-- <h2 class="text-center mb-4 text-white">B·∫£n ƒë·ªì c√°c tr∆∞·ªùng</h2> -->
            <div id="map" class="map-container">
              <!-- Popup Overlay -->
              <div id="popup" class="ol-popup">
                <a href="#" id="popup-closer" class="ol-popup-closer"></a>
                <div id="popup-content"></div>
              </div>
            </div>
          </section>
        
          <!-- OpenLayers JS -->
          <script src="https://cdn.jsdelivr.net/npm/ol@v7.3.0/dist/ol.js"></script>
          <script>
            const view = new ol.View({
              center: ol.proj.fromLonLat([106.660172, 10.762622]), // T·ªça ƒë·ªô TP.HCM
              zoom: 10.6
            });
        
            const osmLayer = new ol.layer.Tile({
              source: new ol.source.OSM({
              attributions: []
              })
            });
        
            const ranhPhuongLayer = new ol.layer.Tile({
              source: new ol.source.TileWMS({
                url: 'http://localhost:8082/geoserver/AHP_THPT/wms',
                params: {
                  'LAYERS': 'AHP_THPT:RGQuan_HCM',
                  'TILED': true,
                  'FORMAT': 'image/png'
                },
                serverType: 'geoserver',
                transition: 0
              })
            });
        
            const truongTHPTLayer = new ol.layer.Tile({
              source: new ol.source.TileWMS({
                url: 'http://localhost:8082/geoserver/AHP_THPT/wms',
                params: {
                  'LAYERS': 'AHP_THPT:truong',
                  'TILED': true,
                  'FORMAT': 'image/png'
                },
                serverType: 'geoserver',
                transition: 0
              })
            });
        
            const map = new ol.Map({
              target: 'map',
              layers: [osmLayer, ranhPhuongLayer, truongTHPTLayer],
              view: view
            });
        
            const popup = document.getElementById('popup');
            const overlay = new ol.Overlay({
              element: popup,
              positioning: 'bottom-center',
              stopEvent: false,
              offset: [0, -10]
            });
            map.addOverlay(overlay);
        
            map.on('singleclick', function (evt) {
              const viewResolution = view.getResolution();
              const url = truongTHPTLayer.getSource().getFeatureInfoUrl(
                evt.coordinate,
                viewResolution,
                'EPSG:3857',
                {
                  'INFO_FORMAT': 'application/json'
                }
              );
              if (url) {
                fetch(url)
                  .then(response => response.json())
                  .then(data => {
                    if (data.features.length > 0) {
                      const props = data.features[0].properties;
                      const content = `<strong>${props.ten_truong}</strong><br/>ƒê·ªãa ch·ªâ: ${props.dia_chi}`;
                      popup.innerHTML = content;
                      overlay.setPosition(evt.coordinate);
                    } else {
                      popup.innerHTML = '';
                    }
                  });
              }
            });
          </script>
        <!-- </div> -->

        <!-- <div class="col-lg-6">
          <h2 class="text-capitalize lh-3 my-3">H·ªÜ TH·ªêNG CH·ªåN TR∆Ø·ªúNG THPT </h2>
         <div class="container">
          <p class="fs-6 fw-semibold text-dark" style="text-align: justify; text-indent: 2em; letter-spacing: 0.01em; line-height: 1.6;">
            K·∫øt qu·∫£ thi v√†o l·ªõp 10 c√¥ng l·∫≠p c√≥ th·ªÉ ƒë√£ mang ƒë·∫øn nh·ªØng n·ªói th·∫•t v·ªçng khi ∆∞·ªõc m∆° v√†o tr∆∞·ªùng c√¥ng l·∫≠p kh√¥ng th√†nh. Nh∆∞ng ƒëi·ªÅu ƒë√≥ kh√¥ng ph·∫£i l√† d·∫•u ch·∫•m h·∫øt cho con ƒë∆∞·ªùng h·ªçc v·∫•n. Thay v√¨ ch√πn b∆∞·ªõc, nhi·ªÅu ph·ª• huynh ƒë√£ b·∫Øt ƒë·∫ßu t√¨m ki·∫øm nh·ªØng tr∆∞·ªùng THPT d√¢n l·∫≠p uy t√≠n, n∆°i con em m√¨nh c√≥ th·ªÉ ti·∫øp t·ª•c h·ªçc t·∫≠p trong m·ªôt m√¥i tr∆∞·ªùng ch·∫•t l∆∞·ª£ng, ph√π h·ª£p v·ªõi nƒÉng l·ª±c v√† ƒëi·ªÅu ki·ªán gia ƒë√¨nh.
          </p>
          <p class="fs-6 fw-semibold text-dark" style="text-align: justify; text-indent: 2em; letter-spacing: 0.01em; line-height: 1.6;">
            Ch√∫ng t√¥i hi·ªÉu ƒë∆∞·ª£c mong mu·ªën ·∫•y, v√† s·∫µn s√†ng h·ªó tr·ª£ qu√Ω ph·ª• huynh v√† c√°c em h·ªçc sinh t√¨m ki·∫øm ng√¥i tr∆∞·ªùng d√¢n l·∫≠p l√Ω t∆∞·ªüng. H√£y chia s·∫ª v·ªõi ch√∫ng t√¥i v·ªÅ nhu c·∫ßu v√† nguy·ªán v·ªçng c·ªßa qu√Ω ph·ª• huynh ƒë·ªÉ c√πng nhau m·ªü ra nh·ªØng c√°nh c·ª≠a m·ªõi cho t∆∞∆°ng lai.
          </p>
        </div>
        </div> -->
      
        <!-- C·ªôt ti√™u ƒë·ªÅ v√† vƒÉn b·∫£n -->
        <!-- <div class="col-lg-6">
          <h2 class="fw-bold mb-4">H·ªÜ TH·ªêNG CH·ªåN TR∆Ø·ªúNG THPT T∆Ø TH·ª§C</h2>
          
          <p class="fs-5 fw-semibold text-dark" style="text-align: justify !important; text-indent: 2em; letter-spacing: 0.01em; line-height: 1.6;">
            K·∫øt qu·∫£ thi v√†o l·ªõp 10 c√¥ng l·∫≠p c√≥ th·ªÉ ƒë√£ mang ƒë·∫øn nh·ªØng n·ªói th·∫•t v·ªçng khi ∆∞·ªõc m∆° v√†o tr∆∞·ªùng c√¥ng l·∫≠p kh√¥ng th√†nh. Nh∆∞ng ƒëi·ªÅu ƒë√≥ kh√¥ng ph·∫£i l√† d·∫•u ch·∫•m h·∫øt cho con ƒë∆∞·ªùng h·ªçc v·∫•n. Thay v√¨ ch√πn b∆∞·ªõc, nhi·ªÅu ph·ª• huynh ƒë√£ b·∫Øt ƒë·∫ßu t√¨m ki·∫øm nh·ªØng tr∆∞·ªùng THPT d√¢n l·∫≠p uy t√≠n, n∆°i con em m√¨nh c√≥ th·ªÉ ti·∫øp t·ª•c h·ªçc t·∫≠p trong m·ªôt m√¥i tr∆∞·ªùng ch·∫•t l∆∞·ª£ng, ph√π h·ª£p v·ªõi nƒÉng l·ª±c v√† ƒëi·ªÅu ki·ªán gia ƒë√¨nh.
          </p>
          
          <p class="fs-5 fw-semibold text-dark" style="text-align: justify !important; text-indent: 2em; letter-spacing: 0.01em; line-height: 1.6;">
            Ch√∫ng t√¥i hi·ªÉu ƒë∆∞·ª£c mong mu·ªën ·∫•y, v√† s·∫µn s√†ng h·ªó tr·ª£ qu√Ω ph·ª• huynh v√† c√°c em h·ªçc sinh t√¨m ki·∫øm ng√¥i tr∆∞·ªùng d√¢n l·∫≠p l√Ω t∆∞·ªüng. H√£y chia s·∫ª v·ªõi ch√∫ng t√¥i v·ªÅ nhu c·∫ßu v√† nguy·ªán v·ªçng c·ªßa qu√Ω ph·ª• huynh ƒë·ªÉ c√πng nhau m·ªü ra nh·ªØng c√°nh c·ª≠a m·ªõi cho t∆∞∆°ng lai.
          </p>
        </div> -->
  
      </div>
    </section>
    <!-- select school  -->
    <section id="select-school">
      <div class="container">
        <div class="row flex-lg-row-reverse align-items-center">
          <div class="col-lg-6">
            <div class="table-responsive mt-3">
              <table id="resultTable" class="table table-bordered text-center table-light-custom">
                <thead class="table-header-custom">
                  <tr>
                    <th class="body-text-color">Ph∆∞∆°ng √°n</th>
                    <th class="body-text-color">T√™n tr∆∞·ªùng</th>
                  </tr>
                </thead>
                <tbody id="resultBody">
                </tbody>
              </table>
            </div>    
          </div>
          <div class="col-lg-6">
            <div class="row billboard-row">
              <div class="col-12 mb-3">
                <label class="form-label fw-bold">Ch·ªçn lo·∫°i tr∆∞·ªùng:</label>
                <select class="form-select" id="loai-truong">
                  <option value="">-- Ch·ªçn lo·∫°i tr∆∞·ªùng --</option>
                  <option value="d√¢n l·∫≠p">D√¢n l·∫≠p</option>
                  <option value="qu·ªëc t·∫ø">Qu·ªëc t·∫ø</option>
                </select>
              </div>
              <!-- 5 dropdown ch·ªçn tr∆∞·ªùng -->
              <div class="col-12">
                <label class="form-label fw-bold">H√£y ch·ªçn 5 tr∆∞·ªùng b·∫°n xem x√©t:</label>
              </div>
              {% for i in range(5) %}
                <div class="col-lg-4 billboard-select mb-2">
                <select class="form-select truong-select" id="truong-select-{{i}}">
                <option value="">-- Ch·ªçn tr∆∞·ªùng --</option>
                {% for truong in truongs %}
                  <option value="{{ truong.truong_id }}" data-loai="{{ truong.laoi_truong|lower }}">{{ truong.ten_truong }}</option>
                {% endfor %}
               </select>
                </div>
              {% endfor %}
              
              <div class="col-lg-12 mt-3">
                <button type="button" class="btn btn-primary" onclick="submitSelectedSchools()">Ch·ªçn</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
   
 <!-- Matrix start  -->
 <section id="matrix-comparison" class="container my-5">
  <h3 class="mb-4 ">B·∫£ng Ma Tr·∫≠n So S√°nh C·∫∑p C√°c Ti√™u Ch√≠</h3>
  <p class="fs-6 text-black-justify" style="text-indent: 2em;">
    ƒê·ªÉ ƒë√°nh gi√° m·ª©c ƒë·ªô quan tr·ªçng gi·ªØa c√°c ti√™u ch√≠, ng∆∞·ªùi d√πng so s√°nh t·ª´ng c·∫∑p ti√™u ch√≠ theo thang ƒëi·ªÉm AHP t·ª´ 1/9 ƒë·∫øn 9.
    Gi√° tr·ªã <em>1</em> th·ªÉ hi·ªán hai ti√™u ch√≠ <em> quan tr·ªçng nh∆∞ nhau </em>; gi√° tr·ªã <em>3, 5, 7, 9</em> cho th·∫•y ti√™u ch√≠ h√†ng ngang <em>quan tr·ªçng h∆°n ti√™u ch√≠ c·ªôt</em> v·ªõi m·ª©c ƒë·ªô tƒÉng d·∫ßn; ng∆∞·ª£c l·∫°i, 
    c√°c gi√° tr·ªã <em>1/3, 1/5, 1/7, 1/9</em> bi·ªÉu th·ªã ti√™u ch√≠ h√†ng ngang <em>k√©m quan tr·ªçng h∆°n</em>. 
  </p> 
  <table class="table table-bordered text-center table-light-custom" id="comparisonMatrix">
    <thead class="table-header-custom">
      <tr>
        <th class="body-text-color">Ti√™u ch√≠</th>
        <th class="body-text-color">Ch·∫•t l∆∞·ª£ng gi√°o d·ª•c</th>
        <th class="body-text-color">C∆° s·ªü v·∫≠t ch·∫•t</th>
        <th class="body-text-color">H·ªçc ph√≠</th>
        <th class="body-text-color">Ho·∫°t ƒë·ªông ngo·∫°i kh√≥a</th>
      </tr>
    </thead>
    <tbody id="matrixBody"></tbody>
  </table>
</section>
<section id="resultSection" class="container my-5" style="display: none;"> 
  <div class="row flex-lg-row-reverse align-items-center">
    <div class="col-lg-6">
      <canvas id="weightsChart" width="400" height="180"></canvas>
    </div>
    <div class="col-lg-6">
      <div class="table-responsive mt-3">
          <table id="weightsTable" class="table table-bordered text-center table-light-custom">
        <thead class="table-header-custom">
        <tr>
          <th class="body-text-color">Ti√™u ch√≠</th>
          <th class="body-text-color">Tr·ªçng s·ªë</th>
        </tr>
        </thead>
        <tbody id="weightsBody">
        </tbody>
      </table>
      </div>
    </div>
  </div>
</section>

<!-- K·∫øt qu·∫£ AHP -->
<section id="ahp-results" class="container mt-5" style="display: none;">
  <h3 class="body-text-color">K·∫øt qu·∫£ X·∫øp H·∫°ng Tr∆∞·ªùng</h3>
  <p class="fs-6 text-black-justify" style="text-indent: 2em;">
    D·ª±a tr√™n nh·ªØng l·ª±a ch·ªçn v√† ƒë√°nh gi√° c·ªßa b·∫°n v·ªÅ c√°c ti√™u ch√≠ quan tr·ªçng, 
    h·ªá th·ªëng ƒë√£ ti·∫øn h√†nh ph√¢n t√≠ch v√† ƒë∆∞a ra b·∫£ng x·∫øp h·∫°ng c√°c tr∆∞·ªùng ph√π h·ª£p nh·∫•t. 
    Hy v·ªçng k·∫øt qu·∫£ n√†y s·∫Ω l√† m·ªôt ngu·ªìn tham kh·∫£o h·ªØu √≠ch, gi√∫p b·∫°n t·ª± tin h∆°n trong qu√° tr√¨nh l·ª±a ch·ªçn ng√¥i tr∆∞·ªùng ph√π h·ª£p. 
    <em>Ch√∫c b·∫°n th√†nh c√¥ng v√† lu√¥n v·ªØng b∆∞·ªõc tr√™n con ƒë∆∞·ªùng h·ªçc v·∫•n c·ªßa m√¨nh nh√© !</em>
  </p>
  <div class="row flex-lg-row-reverse align-items-center">
    <div class="col-lg-6">
      <div class="my-4">
        <canvas id="ahpRankingChart" width="400" height="200"></canvas>
      </div>
    </div>
    <div class="col-lg-6">
      <table class="table table-bordered text-center table-light-custom">
    <thead class="table-header-custom">
      <tr>
        <th class="body-text-color">H·∫°ng</th>
        <th class="body-text-color">T√™n Tr∆∞·ªùng</th>
        <th class="body-text-color">ƒêi·ªÉm AHP</th>
      </tr>
    </thead>
    <tbody id="ahp-results-body"></tbody>
  </table>
    </div>
  </div>
</section>
<section>
  <div class="d-flex justify-content-center mt-4 gap-3">
    <button class="btn btn-warning px-4 rounded-pill shadow-sm fw-semibold fs-6" onclick="calculateAHP()">Ki·ªÉm Tra</button>
    <button class="btn btn-warning px-4 rounded-pill shadow-sm fw-semibold fs-6" onclick="submitAHPMatrix()">T√≠nh to√°n AHP</button>
    <button class="btn btn-warning px-4 rounded-pill shadow-sm fw-semibold fs-6" onclick="openAHPMatrices()">Chi Ti·∫øt K·∫øt Qu·∫£</button>
  </div>
</section>




<!-- <script>
  const criteria = [
    "Ch·∫•t l∆∞·ª£ng gi√°o d·ª•c",
    "C∆° s·ªü v·∫≠t ch·∫•t",
    "H·ªçc ph√≠",
    "Ho·∫°t ƒë·ªông ngo·∫°i kh√≥a"
  ];

  // H√†m ph√¢n t√≠ch ph√¢n s·ªë ho·∫∑c s·ªë th·ª±c
  function parseFraction(value) {
    if (value.includes("/")) {
      const parts = value.split("/");
      if (parts.length === 2) {
        const numerator = parseFloat(parts[0]);
        const denominator = parseFloat(parts[1]);
        if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
          return numerator / denominator;
        }
      }
      return NaN;
    }
    return parseFloat(value);
  }

  // T·∫°o b·∫£ng nh·∫≠p li·ªáu
  function generateMatrix() {
    let tbody = '';
    for (let i = 0; i < criteria.length; i++) {
      tbody += `<tr><th class="text-white">${criteria[i]}</th>`;
      for (let j = 0; j < criteria.length; j++) {
        const id = `cell-${i}-${j}`;
        if (i === j) {
          tbody += `<td><input type="text" value="1" class="form-control text-center" id="${id}" disabled></td>`;
        } else if (j > i) {
          tbody += `<td><input type="text" class="form-control text-center"
                       id="${id}" onchange="updateMatrix(${i}, ${j}, this)"></td>`;
        } else {
          tbody += `<td><input type="text" class="form-control text-center" id="${id}" disabled></td>`;
        }
      }
      tbody += '</tr>';
    }
    document.getElementById('matrixBody').innerHTML = tbody;
  }

  // C·∫≠p nh·∫≠t √¥ ngh·ªãch ƒë·∫£o khi nh·∫≠p
  function updateMatrix(row, col, input) {
    const rawValue = input.value.trim();
    const num = parseFraction(rawValue);

    if (isNaN(num) || num < 1 / 9 || num > 9) {
      alert("Vui l√≤ng nh·∫≠p s·ªë t·ª´ 1/9 ƒë·∫øn 9 (c√≥ th·ªÉ l√† ph√¢n s·ªë nh∆∞ 1/3, 2/5...)");
      input.value = '';
      return;
    }

    const inverse = 1 / num;
    const inverseCell = document.getElementById(`cell-${col}-${row}`);
    if (inverseCell) inverseCell.value = inverse.toFixed(4).replace(/\.?0+$/, "");

    document.getElementById(`cell-${row}-${row}`).value = "1";
    document.getElementById(`cell-${col}-${col}`).value = "1";
  }

  // Kh·ªüi t·∫°o khi trang t·∫£i
  document.addEventListener("DOMContentLoaded", generateMatrix);
</script> -->
<script>
  const criteria = [
    "Ch·∫•t l∆∞·ª£ng gi√°o d·ª•c",
    "C∆° s·ªü v·∫≠t ch·∫•t",
    "H·ªçc ph√≠",
    "Ho·∫°t ƒë·ªông ngo·∫°i kh√≥a"
  ];

  // H√†m ph√¢n t√≠ch ph√¢n s·ªë ho·∫∑c s·ªë th·ª±c
  function parseFraction(value) {
    if (value.includes("/")) {
      const parts = value.split("/");
      if (parts.length === 2) {
        const numerator = parseFloat(parts[0]);
        const denominator = parseFloat(parts[1]);
        if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
          return numerator / denominator;
        }
      }
      return NaN;
    }
    return parseFloat(value);
  }

  function generateMatrix() {
    let tbody = '';
    for (let i = 0; i < criteria.length; i++) {
      tbody += `<tr><th class="text-white">${criteria[i]}</th>`;
      for (let j = 0; j < criteria.length; j++) {
        const id = `cell-${i}-${j}`;
        if (i === j) {
          tbody += `<td><input type="text" value="1" class="form-control text-center" id="${id}" disabled></td>`;
        } else if (j > i) {
          tbody += `<td><input type="text"  class="form-control text-center"
                     id="${id}" onchange="updateMatrix(${i}, ${j}, this)"></td>`;
        } else {
          tbody += `<td><input type="text" class="form-control text-center" id="${id}" disabled></td>`;
        }
      }
      tbody += '</tr>';
    }
    document.getElementById('matrixBody').innerHTML = tbody;
  }

  function updateMatrix(row, col, input) {
    const rawValue = input.value.trim();
    const num = parseFraction(rawValue);

    if (isNaN(num) || num < 1/9 || num > 9) {
      alert("Vui l√≤ng nh·∫≠p s·ªë t·ª´ 1/9 ƒë·∫øn 9 (c√≥ th·ªÉ l√† ph√¢n s·ªë nh∆∞ 1/3, 2/5...)");
      input.value = '';
      return;
    }

    const inverse = 1 / num;
    const inverseCell = document.getElementById(`cell-${col}-${row}`);
    if (inverseCell) inverseCell.value = inverse.toFixed(4).replace(/\.?0+$/, "");

    document.getElementById(`cell-${row}-${row}`).value = "1";
    document.getElementById(`cell-${col}-${col}`).value = "1";
  }

  function calculateAHP() {
    const n = criteria.length;
    let matrix = [];

    for (let i = 0; i < n; i++) {
      matrix[i] = [];
      for (let j = 0; j < n; j++) {
        const cell = document.getElementById(`cell-${i}-${j}`);
        if (!cell || cell.value === '') {
          alert(`√î (${i + 1}, ${j + 1}) ch∆∞a h·ª£p l·ªá ho·∫∑c thi·∫øu d·ªØ li·ªáu!`);
          return;
        }

        const value = parseFraction(cell.value);
        if (isNaN(value) || value <= 0) {
          alert(`√î (${i + 1}, ${j + 1}) kh√¥ng h·ª£p l·ªá!`);
          return;
        }

        matrix[i][j] = value;
      }
    }

    // T·ªïng c·ªôt
    let colSums = new Array(n).fill(0);
    for (let j = 0; j < n; j++) {
      for (let i = 0; i < n; i++) {
        colSums[j] += matrix[i][j];
      }
    }

    // Chu·∫©n h√≥a
    let normalizedMatrix = [];
    for (let i = 0; i < n; i++) {
      normalizedMatrix[i] = [];
      for (let j = 0; j < n; j++) {
        normalizedMatrix[i][j] = matrix[i][j] / colSums[j];
      }
    }

    // Tr·ªçng s·ªë
    let weights = [];
    for (let i = 0; i < n; i++) {
      let sum = 0;
      for (let j = 0; j < n; j++) {
        sum += normalizedMatrix[i][j];
      }
      weights[i] = sum / n;
    }

    // Lambda max
    let lambdaMax = 0;
    for (let i = 0; i < n; i++) {
      let rowSum = 0;
      for (let j = 0; j < n; j++) {
        rowSum += matrix[i][j] * weights[j];
      }
      lambdaMax += rowSum / weights[i];
    }
    lambdaMax /= n;

    const CI = (lambdaMax - n) / (n - 1);
    const RI = 0.9;
    const CR = CI / RI;

    // K·∫øt qu·∫£
    const isValid = CR < 0.1;
    if (isValid) {
    alert(`‚úÖ Ch·ªâ s·ªë nh·∫•t qu√°n (CR): ${CR.toFixed(3)} ‚Äì H·ª£p l·ªá`);
    document.getElementById("resultSection").style.display = "block";
  } else {
    alert(`‚ùå Ch·ªâ s·ªë nh·∫•t qu√°n (CR): ${CR.toFixed(3)} ‚Äì Kh√¥ng h·ª£p l·ªá`);
    document.getElementById("resultSection").style.display = "none";
  }
    // üëâ Hi·ªÉn th·ªã b·∫£ng tr·ªçng s·ªë
const weightsBody = document.getElementById("weightsBody");
weightsBody.innerHTML = ""; // X√≥a d·ªØ li·ªáu c≈© n·∫øu c√≥

// D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì
const labels = [];
const data = [];

for (let i = 0; i < n; i++) {
  const row = document.createElement("tr");

  const criteriaCell = document.createElement("td");
  criteriaCell.textContent = criteria[i];
  labels.push(criteria[i]); // label cho bi·ªÉu ƒë·ªì

  const weightCell = document.createElement("td");
  weightCell.textContent = weights[i].toFixed(3);
  data.push(weights[i]); // data cho bi·ªÉu ƒë·ªì

  row.appendChild(criteriaCell);
  row.appendChild(weightCell);
  weightsBody.appendChild(row);
}

// Hi·ªÉn th·ªã bi·ªÉu ƒë·ªì tr·ªçng s·ªë
const ctx = document.getElementById("weightsChart").getContext("2d");

// X√≥a bi·ªÉu ƒë·ªì c≈© n·∫øu c√≥
if (window.weightsChart instanceof Chart) {
  window.weightsChart.destroy();
}

// T·∫°o bi·ªÉu ƒë·ªì m·ªõi
window.weightsChart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [{
      label: 'Tr·ªçng s·ªë ti√™u ch√≠',
      data: data,
      backgroundColor: 'rgba(30, 74, 50, 1)',
      borderColor: 'rgba(30, 74, 50, 1)',
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: {
        beginAtZero: true,
        max: 1
      }
    }
  }
  });
  document.getElementById("resultSection").style.display = "block";
  }

  document.addEventListener("DOMContentLoaded", generateMatrix);
</script>

  <!-- Footer start  -->
  <section id="footer">
     
    <footer class="d-flex flex-wrap justify-content-between align-items-center border-top"></footer>

    <div class="container">
      <footer class="d-flex flex-wrap justify-content-between align-items-center py-2 ">
        <div class="col-md-8 d-flex align-items-center">
          <p>¬© 2025 - H·ªá h·ªó tr·ª£ ra quy·∫øt ƒë·ªãnh ch·ªçn tr∆∞·ªùng THPT d√¢n l·∫≠p v·ªõi ph∆∞∆°ng ph√°p AHP</p>

        </div>
        <div class="col-md-4 d-flex align-items-end">
          <p>Sinh vi√™n th·ª±c hi·ªán: <a href="https://templatesjungle.com/" class="link-primary"
              target="_blank">Nh√≥m 4</a> <br> L·ªõp: <a href="https://themewagon.com" class="link-primary"
              target="_blank">10_ƒêH_TTMT</a></p>

        </div>

      </footer>
    </div>
  </section>


  <script src="static/js/jquery-1.11.0.min.js"></script>
  <script src="static/js/script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
  
  <script src="{{ url_for('static', filename='js/selectSchool.js') }}"></script>
</body>

</html>